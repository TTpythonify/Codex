services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    env_file:
      - .env
    depends_on:
      - piston
    networks:
      - codex-network

  piston:
    image: ghcr.io/engineer-man/piston:latest
    ports:
      - "2000:2000"
    volumes:
      - piston-packages:/piston/packages
      - piston-isolate:/piston/isolate
      - piston-jobs:/piston/jobs
    user: "1000:1000"
    networks:
      - codex-network
    environment:
      - PISTON_LOG_LEVEL=INFO

volumes:
  piston-packages:
  piston-isolate:
  piston-jobs:

networks:
  codex-network:
    driver: bridge
